---
title: "Ecological Risk Model"
author: "Toni Monleon. BIOST3. UNIV BARCELONA"
date: "20/5/2020"
output: html_document
---
```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = F, message=FALSE, warning=FALSE)
```

## Representation of data in Spain and Catalonia for the article
Data until 22-7-2020
```{r}
library(BDSbiost3)
```


```{r}
 library(readr)
datos_ccaas <- read_csv("datos_ccaas.csv")
#datos de catalunya
cat<- datos_ccaas[ which(datos_ccaas$ccaa_iso=='CT'), ]
plot(cat$num_casos~cat$fecha,type="l",col="blue",xlab="date", ylab="daily cases (COVID19)")
 
library(BDSbiost3)
 #Predict evolution of cases in Spain with an "ad-hoc" model ()
pred.Casos.diarios<-covid.cases.cumcases3(X=seq(1:168), Y=cat$num_casos, max.cases.free=T, max.cases = max(cat$num_casos), lim.days=365,iterations = 20, label.ind="CATALONIA: PREDICTION COVID-19 (DAY1: 31/01/2020)", duration_pandemic=200)

#Number of total cases
sum((cat$num_casos))

sum((cat$num_casos))/7609499 #per inhabitants

100000*sum((cat$num_casos))/7609499 #per 100.000 inhabitants


```


##Times Series Plot
```{r}
library(dplyr)
library(ggplot2)
library(RColorBrewer)

Sys.setlocale("LC_ALL", "English")
theme_update(plot.title = element_text(hjust = 0.5))
ggplot(data=cat, aes(y=cat$num_casos, x=cat$fecha )) +
  geom_line(color="steelblue")+
   theme_bw()+
   ylim(0, 2000)+
   ggtitle (" COVID-19 daily cases from February to July in 2020")+
   xlab("2020")+
   ylab("COVID-19 Cases")+
   scale_x_date(date_labels = "%B")+
   theme(axis.text.x = element_text(angle=45, hjust = 1, ))+
   theme_minimal()

max(cat$num_casos, na.rm = TRUE)
```



## Analysis of a COVID19 risk model
Data management based on incidence data, IDESCAT data and air pollution data:
```{r }

#Data on incidence rates and density
library(readxl)                         
model_risk<- read_excel("dadesCanela_modelrisk (1).xlsx", sheet = "JUNTO_TODO", skip = 1)

colnames(model_risk)= c("health_area","positive_cases","suspected_cases","raw_rate_10k","standar_rate_10k","insured_people ","municipality","population","surface_km2", "density", "rank_number_inhabitant","municipality_1","NOX_reduction_january2020","NOX_reduction_february2020","NOX_reduction_march2020","NOX_reduction_april2020","NOX_reduction_may2020","health_area_1","income_euros","income_euros_inhab" , "income_index_100")

head(model_risk)
```



## Exploratory analysis of population density, wealth and pollution reduction (indirect mobility)
Below is an exploratory analysis of the regressors and the response variable and different predictive models of the risk of coronavirus.
Some descriptive analyzes of the rate of COVID-19 in municipalities of Catalonia and density and population, population and reduction of pollution by NOx during 2017 - 2020 are presented.

# Mobility using indirect variables (densidad y poblacion por municipio)
Data obtained from IDESCAT
```{r}
library(Rmisc)
library(gplots)
library(ggplot2)
library(DescTools)
#DESCRIPTIVE OF NO2 BY YEAR
res.RMISC.Q <- summarySE(model_risk, measurevar="density", groupvars=c("municipality"),na.rm = T)
res.RMISC.Q 

```




# Mobility using indirect variables
Data obtained from IDESCAT.
https://www.idescat.cat/pub/?id=aec&tema=macro&n=82&lang=es 

income_euros :  RFDB (milers d'euros)
income_euros_inhab: RFDB per habitant (milers d'euros)
income_index_100: RFDB per habitant (índex Catalunya=100)


```{r}
library(Rmisc)
library(gplots)
library(ggplot2)
library(DescTools)

model_risk$income_euros<- as.numeric(model_risk$income_euros)
model_risk$income_euros_inhab<- as.numeric(model_risk$income_euros_inhab)
model_risk$income_index_100<- as.numeric(model_risk$income_index_100)


#Descriptive analysis for family incomes in thousands of euros (income_euros).
res.RMISC.Q <- summarySE(model_risk, measurevar="income_euros", groupvars=c("municipality"),na.rm = T)
res.RMISC.Q #descriptive

```


#Descriptive analysis for family incomes in thousands of euros per inhabitants (income_euros_inhab).

```{r}
##Descriptive analysis for family incomes in thousands of euros per inhabitants (income_euros_inhab). 
res.RMISC.Q <- summarySE(model_risk, measurevar="income_euros_inhab", groupvars=c("municipality"),na.rm = T)
res.RMISC.Q #descriptive analysis
```

#Descriptive analysis for family incomes as index (index Catalonia = 100)

```{r}
##Descriptive analysis for family incomes as index (index Catalonia = 100)
res.RMISC.Q <- summarySE(model_risk, measurevar="income_index_100", groupvars=c("municipality"),na.rm = T)
res.RMISC.Q #descriptiva
```


# Mobility using indirect variables (contamination in the control points)

Nox will be studied in aggregates from different control points in Catalonia by year (2007-2020), month and municipality.

See source: 
https://analisi.transparenciacatalunya.cat/Medi-Ambient/Dades-d-immissi-dels-punts-de-mesurament-de-la-Xar/uy6k-2s8r/data

```{r}
## open data frame "DATOS_AGREGADOS_2017_2020.Rda" whit variables as NOx by mes, year and Catalonia municipality
load("DATOS_AGREGADOS_2017_2020.Rda")
DATOS_AGREGADOS_2017_2020.1<-DATOS_AGREGADOS_2017_2020

#Delete infinite data
is.na(DATOS_AGREGADOS_2017_2020.1) <- sapply(DATOS_AGREGADOS_2017_2020.1, is.infinite)
DATOS_AGREGADOS_2017_2020.1$MUNICIPI<-DATOS_AGREGADOS_2017_2020.1$Group.3

#Cols variables
library(dplyr)
DATOS_AGREGADOS_2017_2020.1<- DATOS_AGREGADOS_2017_2020.1 %>% 
  rename(
    year = ANY,
    month = MES,
    municipality=MUNICIPI 
      )
head(DATOS_AGREGADOS_2017_2020.1)
```

Summary of NOx by year
```{r}
library(Rmisc)
library(gplots)
library(ggplot2)
library(DescTools)

#Descriptive analyses of  NOx by year.
res.RMISC.Q <- summarySE(DATOS_AGREGADOS_2017_2020.1, measurevar="NO.MAX", groupvars=c("year"),na.rm = T)

res.RMISC.Q 
plotmeans(NO.MAX~ year, data=DATOS_AGREGADOS_2017_2020.1, frame = T,xlab = "YEAR OF ANALYSIS", ylab="maximum NOx") 


```

Nox data per month and year.
```{r}

#NOx per month and year.

res.RMISC.Q1 <- summarySE(DATOS_AGREGADOS_2017_2020.1, measurevar="NO.MAX", groupvars=c("year","month"),na.rm = T)
res.RMISC.Q1 #descriptiva
plotmeans(NO.MAX~ month, data=DATOS_AGREGADOS_2017_2020.1, frame = T,xlab = "MONTH OF ANALYSIS", ylab="maximum NOx") 




```


Nox data per municipality, month and year:
```{r}
#Nox data per municipality, month and year
res.RMISC.Q <- summarySE(DATOS_AGREGADOS_2017_2020.1, measurevar="NO.MAX", groupvars=c("municipality", "year","month"),na.rm = T)
AGGREGATENOX.MUN.YEAR.MONTH<-res.RMISC.Q #descriptive
plotmeans(NO.MAX~ municipality , data=DATOS_AGREGADOS_2017_2020.1, frame = T,xlab = "CITY", ylab="maximum NOx") #PLOT DE LAB

```

Calculation of aggregated data
```{r}
#Calculation of aggregate data of NOX per municipality, year and month.
#AGGREGATENOX.MUN.YEAR.MONTH

MAM_2020 <- AGGREGATENOX.MUN.YEAR.MONTH[ which(AGGREGATENOX.MUN.YEAR.MONTH$year=="2020"), c(1,2,3,5)]
MAM_2019 <- AGGREGATENOX.MUN.YEAR.MONTH[ which(AGGREGATENOX.MUN.YEAR.MONTH$year=="2019"), c(1,2,3,5) ]
MAM_2018 <- AGGREGATENOX.MUN.YEAR.MONTH[ which(AGGREGATENOX.MUN.YEAR.MONTH$year=="2018"), c(1,2,3,5) ]
MAM_2017 <- AGGREGATENOX.MUN.YEAR.MONTH[ which(AGGREGATENOX.MUN.YEAR.MONTH$year=="2017"), c(1,2,3,5) ]

#Aggregate value 2020-2017
total.agregat1<- merge(MAM_2020,MAM_2019, by=c("municipality","month"))
total.agregat2<- merge(total.agregat1,MAM_2018, by=c("municipality","month"))
total.agregat3<- merge(total.agregat2,MAM_2017, by=c("municipality","month"))


#names(total.agregat3 )
colnames( total.agregat3)<- c("municipality", "month",      "year.x",    "NO.MAX.2020", "year.y", "NO.MAX.2019", "year.x1",   "NO.MAX.2018", "year.y1",    "NO.MAX.2017")
#percentage difference between the average per month of 2017-2019 compared to 2020.

for(i in 1:dim(total.agregat3)[1]){
   #i<-9
   total.agregat3$media2017_2019[i] <- 
      mean(c(total.agregat3$NO.MAX.2019[i] ,
                total.agregat3$NO.MAX.2018[i] , 
                total.agregat3$NO.MAX.2017[i]),na.rm = T) 
   
   total.agregat3$per.var2020_otros[i]<-100*(total.agregat3$media2017_2019[i]
                                      -total.agregat3$NO.MAX.2020[i])/total.agregat3$media2017_2019[i]
}
```


Percentage reduction (%) of Nox in the months of the year 2017-2020:
```{r}

#percent nox reduction
#Descriptive analysis of NOx per month, year and municipality
res.1 <- summarySE(total.agregat3, measurevar="per.var2020_otros", groupvars=c("municipality","month"),na.rm = T)
res.1

plotmeans(per.var2020_otros~month, data=total.agregat3, frame = T,xlab = "% REDUCCION NOX 2017-19 VS 2020 CATALUNYA") #PLOT DE LAB
```

```{r}
library(ggpubr)
library(dplyr)
attach(total.agregat3)

dpl3= total.agregat3 %>% select(month, per.var2020_otros)
ggerrorplot(dpl3, x=month, y=per.var2020_otros , desc_stat = "mean_sd")


#ggplot(total.agregat3, aes(x=MES, y=per.var2020_otros)) + 
#geom_errorbar(aes(ymin=per.var2020_otros-MES, ymax=per.var2020_otros+ MES), width=.1) +
#geom_line() +
#geom_point()
```



Grafico de reducción porcentual de Nox por municipio

```{r}
#por municipio
plotmeans(per.var2020_otros~ municipality, data=total.agregat3, frame = T, main = "% NOX REDUCTION 2017-19 VS 2020 IN CATALONIA", xlab="CITY") #PLOT DE LAB

```

## Plots of the relationship between population density, pollution and COVID-19
Raw rate vs density inhabitants/km2
```{r pressure, echo=FALSE}
plot(model_risk$raw_rate_10k ~ model_risk$density, data=model_risk, xlab="Density inhabitants/km2", ylab="raw rate ")


```
Taxa estandaritzada vs densidad hab/km2:
```{r}
plot(model_risk$taxa_estandard_10k ~ model_risk$`Densidad hab./km2`, data=model_risk, xlab="Densidad hab./km2", ylab="taxa_estandard_10k")
```

Casos positivos vs densidad hab/km2:
```{r}
plot(model_risk$casos_positius ~ model_risk$`Densidad hab./km2`, data=model_risk, xlab="Densidad hab./km2", ylab="casos_positius")

#lines(x<-model_risk$casos_positius,predict(res3),col='magenta')

```


taxa_estandard_10k % reduccion NOx marzo 2020 respecto 2017-2019
```{r}
plot(model_risk$taxa_estandard_10k ~ model_risk$NOX_RED_marzo2020, data=model_risk, col="red", xlab="Red NOx marzo 2020 vs marzo 2017-2019", ylab="taxa_estandard_10k COVID19", xlim=c(0, 60))
```


taxa_estandard_10k % reduccion NOx abril 2020 respecto 2017-2019
```{r}
plot(model_risk$taxa_estandard_10k ~ model_risk$NOX_RED_abril2020, data=model_risk, col="red", xlab="Red NOx abril 2020 vs abril 2017-2019", ylab="taxa_estandard_10k COVID19", xlim=c(0, 80))
```


Son modelos no lineales de tipo saturativo, es decir el riesgo no aumenta mas allá de los 5000 habitantes.


taxa_estandard_10k % reduccion NOx mayo 2020 respecto 2017-2019
```{r}
plot(model_risk$taxa_estandard_10k ~ model_risk$NOX_RED_mayo2020, data=model_risk, col="red", xlab="Red NOx mayo 2020 vs mayo 2017-2019", ylab="taxa_estandard_10k COVID19", xlim=c(0, 120))
```


## Modelizacion del riesgo de COVID-19 en Catalunya en datos agregados

Para esta modelización vamos a seguir lo indicado por Morgenstern (1982)

H Morgenstern. Uses of Ecologic Analysis in Epidemiologic Research. Am J Public Health, 1982 Dec;72(12):1336-44.

Abstract

Despite the widespread use of ecologic analysis in epidemiologic research and health planning, little attention has been given by health scientists and practitioners to the methodological aspects of this approach. This paper reviews the major types of ecologic study designs, the analytic methods appropriate for each, the limitations of ecologic data for making causal inferences and what can be done to minimize these problems, and the relative advantages of ecologic analysis. Numerous examples are provided to illustrate the important principles and methods. A careful distinction is made between ecologic studies that generate or test etiologic hypotheses and those that evaluate the impact of intervention programs or policies (given adequate knowledge of disease etiology). Failure to recognize this difference in the conduct of ecologic studies can lead to results that are not very informative or that are misinterpreted by others.

Donde se indica como calcular el riesgo relativo ecologico de un evento (en este caso COVID) respecto a un factor de riesgo continuo (ej: movilidad, densidad de población) continuos utilizando una función de regresión. Es un abordaje muy ineteresante para datos agregados como en este caso.






## PRIMERAS PRUEBAS CON TODOS LOS REGRESORES Y VARIABLES: Linear regression y determinación del riesgo relativo ecológico (individual y poblacional, univariante y multivariante)

Se pretende mediante un modelo del tipo incidencia ~f(mobilitat, densitat)
determinar el riesgo relativo ecologico (Morguensen, 1982) de que una persona tenga la enfermedad y el riesgo poblacional, utilizando epidemiologia ecológica.

El nivel de agregación en este caso es: municipio/porción presente en el sistema de la Generalitat

Otros niveles de agregación podrían ser:

9 regions sanitaries
41 comarques
366 areas basiques de salut

Las variables dependientes (Y) a predecir son: 
-taxa_crua_10k :
-taxa_estandard_10k
-casos_positius

Variables regresoras (Xi):

-Densidad de poblacion/km2
-Población
-Superficie km2
-RFDB_miles_e
-RFDB_hab_m
-RFDB_hab_inx
-Reduccion % Nox de marzo 2020 vs 2017-2019
-Reduccion % Nox de abril 2020 vs 2017-2019
-Reduccion % Nox de mayo 2020 vs 2017-2019

A continuación se Modelos de regresión multiple con diversos regresores (densidad, poblacion):

```{r}
# taxa_estandard_10k
#names(model_risk)
#datos demograficos
# taxa_crua
res1<-lm(taxa_crua_10k ~ `Densidad hab./km2` + `Superficie km2` + `Población` , data=model_risk)
summary(res1)
```

taxa_ESTANDARITZADA vs poblacion+ densidad + superficie:
```{r}
# taxa_ESTANDARITZADA
res2<-lm(taxa_estandard_10k ~ `Densidad hab./km2` + `Superficie km2` + `Población` , data=model_risk)
summary(res2)

```



Casos positius vs poblacion
```{r}
#casos_positius
res3<-lm(casos_positius ~ `Densidad hab./km2` + `Superficie km2` + `Población`, data=model_risk)
summary(res3)
```



taxa_ESTANDARITZADA vs densidad hab/km2:
```{r}
# taxa_ESTANDARITZADA
res2<-lm(taxa_estandard_10k ~ `Densidad hab./km2` , data=model_risk)
summary(res2)

```










**Riesgo relativo ecológico Morguenson 1982 ** de densidad hab/km2 respecto a COVID-19 (taxa_ESTANDARITZADA vs) :


```{r}
# taxa_ESTANDARITZADA
res2<-lm(taxa_estandard_10k ~ `Densidad hab./km2` , data=model_risk)
#summary(res2)
print("riesgo relativo ecologico (RRE)")
(res2$coefficients[1] + res2$coefficients[2])/res2$coefficients[1] 


################################################################################
#compute RRE and its CI95 using resampling
#funcion RRE
RRE<-function(X,Y,num.itera=100,nsize=10){
   DM<-data.frame(X=X, Y=Y)
   res2<-lm(Y ~ X , data=DM)

   #Relative ecologic risk (mean and CI95)
   RRE_mean<-(res2$coefficients[1] + res2$coefficients[2])/res2$coefficients[1] 
   print("========================================================")
   cat("Relative ecologic risk (RRE) [estimation]= ",RRE_mean,sep="")
   print("========================================================")
   
   #bootstrap Ci95 percent
   #length.Y<-num.itera
   my.array.RRE <- array(NA, dim=c(num.itera,1))
   for (i in 1:num.itera){
      DM.sample<-DM[sample(nrow(DM), nsize,replace = T), ]
      
      res3<-lm(Y ~ X , data=DM.sample)
      RRE_mean<-(res3$coefficients[1] + res3$coefficients[2])/res3$coefficients[1] 
      my.array.RRE[i,1] <- RRE_mean #valor real
      #print(RRE_mean)
  
   }

   #ci95
  library(Rmisc)
  res.REE.CI<-CI(my.array.RRE[,1], ci=0.95)   
  print("========================================================")
  #Relative ecologic risk (mean and CI95)
  cat("Relative ecologic risk (RRE) CI95 interval [UL, mean, LL]= ",res.REE.CI,sep=",")
  print("========================================================")
  print("")
   
  return(res.REE.CI)
}

final.RRE<-RRE(X=model_risk$`Densidad hab./km2`,Y=model_risk$taxa_estandard_10k,num.itera=1000,nsize=200)

final.RRE

```


CONTAMINACION --------------------- MEDIDA INDIRECTA DE LA MOVILIDAD 

Modelos de regresión multiple con diversos regresores (reduccion de la contaminacion):

Taxa crua vs reduccion contaminacio
```{r}

#cambiar formato de datos
model_risk$NOX_RED_enero2020<- as.numeric(model_risk$NOX_RED_enero2020)
model_risk$NOX_RED_febrero2020<- as.numeric(model_risk$NOX_RED_febrero2020)
model_risk$NOX_RED_marzo2020<- as.numeric(model_risk$NOX_RED_marzo2020)
model_risk$NOX_RED_abril2020<- as.numeric(model_risk$NOX_RED_abril2020)
model_risk$NOX_RED_mayo2020<- as.numeric(model_risk$NOX_RED_mayo2020)
#summary(model_risk)



```


Modelos de regresión para la reduccion de la contaminacion



taxa_estandard_10k vs reduccion contaminacio (marzo 2020) y **Riesgo relativo ecologico Morguenson 1982 **
```{r}

#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_estandard_10k ~ NOX_RED_marzo2020 , data=model_risk)
summary(res1)

print("riesgo relativo ecologico (RRE)")
(res1$coefficients[1] + res1$coefficients[2])/res1$coefficients[1] 


#using resamplen to compute CI95
final.RRE<-RRE(X=model_risk$NOX_RED_marzo2020,Y=model_risk$taxa_estandard_10k,
               num.itera=1000,nsize=200)

final.RRE


```



taxa_estandard_10k vs reduccion contaminacio (abril 2020) y **Riesgo relativo ecolÓgico Morguenson 1982 **:
```{r}

#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_estandard_10k ~ NOX_RED_abril2020 , data=model_risk)
summary(res1)

print("riesgo relativo ecologico (RRE)")
(res1$coefficients[1] + res1$coefficients[2])/res1$coefficients[1] 

#using resamplen to compute CI95
final.RRE<-RRE(X=model_risk$NOX_RED_abril2020,Y=model_risk$taxa_estandard_10k,
               num.itera=1000,nsize=200)

final.RRE

```


taxa_estandard_10k vs reduccion contaminacio (mayo 2020) y **Riesgo relativo ecolÓgico Morguenson 1982 **:
```{r}

#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_estandard_10k ~ NOX_RED_mayo2020 , data=model_risk)
summary(res1)

print("riesgo relativo ecologico (RRE)")
(res1$coefficients[1] + res1$coefficients[2])/res1$coefficients[1] 

#using resamplen to compute CI95
final.RRE<-RRE(X=model_risk$NOX_RED_mayo2020,Y=model_risk$taxa_estandard_10k,
               num.itera=100,nsize=200)

final.RRE

```

  




taxa_estandard_10k vs reduccion contaminacio (varios meses):
```{r}

#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_estandard_10k ~ NOX_RED_marzo2020 + NOX_RED_abril2020 + NOX_RED_mayo2020 , data=model_risk)
summary(res1)

```



taxa_estandard_10k vs reduccion contaminacio:

```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_estandard_10k ~ NOX_RED_marzo2020 + NOX_RED_abril2020 + NOX_RED_mayo2020 , data=model_risk)
summary(res1)
```

casos_positius vs reduccion de la contaminacion:
```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(casos_positius ~ NOX_RED_marzo2020 + NOX_RED_abril2020 + NOX_RED_mayo2020 , data=model_risk)
summary(res1)
```


## ###################################################################################
## MODELOS UNIVARIANTES DE RIESGO DE COVID-19 ---Y=taxa_estandard_10k: --------------
## ###################################################################################

Se pretende mediante un modelo del tipo incidencia ~f(mobilitat, densitat)
determinar el riesgo relativo ecologico (Morguensen, 1982) de que una persona tenga la enfermedad y el riesgo poblacional, utilizando epidemiologia ecológica.

El nivel de agregación en este caso es: municipio/porción presente en el sistema de la Generalitat

Otros niveles de agregación podrían ser:

9 regions sanitaries
41 comarques
366 areas basiques de salut

Las variables dependientes (Y) a predecir son: 
-taxa_crua_10k 
-taxa_estandard_10k: SE TOMA ESTA COMO PREDICTORA
-casos_positius

Variables regresoras (Xi):

-Densidad de poblacion/km2
-Población
-Superficie km2
-RFDB (milers d'euros) 	
-RFDB per habitant (milers d'euros)	
-RFDB per habitant (índex Catalunya=100)
-Reduccion % Nox de marzo 2020 vs 2017-2019
-Reduccion % Nox de abril 2020 vs 2017-2019
-Reduccion % Nox de mayo 2020 vs 2017-2019


```{r}
#install.packages("corrplot")
#install.packages("Hmisc")
library("Hmisc")
attach(model_risk)
subset1= model_risk %>%select(taxa_crua_10k, `Densidad hab./km2`, NOX_RED_enero2020, NOX_RED_febrero2020, NOX_RED_marzo2020, NOX_RED_abril2020 , NOX_RED_mayo2020, RFDB_hab_m)
cor1= rcorr(as.matrix(subset1))
cor1

#Grafico de correlacion
library(corrplot)
M= cor(subset1, use="pairwise.complete.obs")
corrplot(M, method= "number", type = "upper")

```


A continuación se Modelos de regresión multiple con diversos regresores (densidad, poblacion):


# Modelización del riesgo de COVID-19 (Y= taxa_estandard_10k, X=  densidad de poblacion)

taxa_estandard_10k:

```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_estandard_10k ~ `Densidad hab./km2` , data=model_risk)
summary(res1)


print("riesgo relativo ecologico (RRE)---------------------------------:")
(res1$coefficients[1] + res1$coefficients[2])/res1$coefficients[1] 


```






# Modelización del riesgo de COVID-19 (Y= taxa_estandard_10k, X=  RFDB_miles_e)
RFDB (milers d'euros) 	


```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_estandard_10k ~ RFDB_miles_e , data=model_risk)
summary(res1)


print("riesgo relativo ecologico (RRE)---------------------------------:")
(res1$coefficients[1] + res1$coefficients[2])/res1$coefficients[1] 


```







# Modelización del riesgo de COVID-19 (Y= taxa_estandard_10k, X=  RFDB_hab_m)

RFDB per habitant (milers d'euros)	
```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_estandard_10k ~ RFDB_hab_m , data=model_risk)
print(res1)
summary(res1)


print("riesgo relativo ecologico (RRE)---------------------------------:")
(res1$coefficients[1] + res1$coefficients[2])/res1$coefficients[1] 

final.RRE<-RRE(X=model_risk$RFDB_hab_m,Y=model_risk$taxa_estandard_10k,
               num.itera=1000,nsize=200)

final.RRE

```






# Modelización del riesgo de COVID-19 (Y= taxa_estandard_10k, X=  RFDB_hab_inx)
RFDB per habitant (índex Catalunya=100)
```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_estandard_10k ~ RFDB_hab_inx , data=model_risk)
summary(res1)


print("riesgo relativo ecologico (RRE)---------------------------------:")
(res1$coefficients[1] + res1$coefficients[2])/res1$coefficients[1] 


```





# Modelización del riesgo de COVID-19 (Y= taxa_estandard_10k, X=  reduccion de contaminacion en ABRIL 2020 )
X= reduccion de contaminacion en MARZO (PORCENTAJE MEDIO DE REDUCCION EN ESTACIONES AUTOMATICAS DEL MES DE ABRIL 2020 RESPECTO A ABRIL DE 2017-2019)
```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_estandard_10k ~ NOX_RED_abril2020 , data=model_risk)
summary(res1)


print("riesgo relativo ecologico (RRE)---------------------------------:")
(res1$coefficients[1] + res1$coefficients[2])/res1$coefficients[1] 


```


# Modelización del riesgo de COVID-19 (Y= taxa_estandard_10k, X=  reduccion de contaminacion en MAYO 2020 )
X= reduccion de contaminacion en MARZO (PORCENTAJE MEDIO DE REDUCCION EN ESTACIONES AUTOMATICAS DEL MES DE MAYO 2020 RESPECTO A MAYO DE 2017-2019)

```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_estandard_10k ~ NOX_RED_mayo2020 , data=model_risk)
summary(res1)


print("riesgo relativo ecologico (RRE)---------------------------------:")
(res1$coefficients[1] + res1$coefficients[2])/res1$coefficients[1] 


```



## ###################################################################################
## MODELOS MULTIVARIANTES DE RIESGO DE COVID-19 ---Y=taxa_estandard_10k: -----------------------
## ###################################################################################

# Modelización del riesgo de COVID-19 con INTERACCION (Y= casos COVID-19/TASA, X= reduccion de contaminacion en MARZO, ABRIL, mayo, RFDB_hab_m, densidad de poblacion)

J Canela 11-6-20

SIN INTERACCION 

```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_crua_10k ~ NOX_RED_marzo2020 + `Densidad hab./km2`  + RFDB_hab_m, data=model_risk)
summary(res1)
```


Linear regression with  interaction for march 2020 
```{r}
#datos demograficos
#taxa_estandard_10k

res1<-lm(taxa_crua_10k ~ NOX_RED_marzo2020 + `Densidad hab./km2` + NOX_RED_marzo2020* `Densidad hab./km2` , data=model_risk)
summary(res1)
```




Linear regression with no interaction for April 2020 
```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_crua_10k ~ NOX_RED_abril2020 + `Densidad hab./km2`  , data=model_risk)
summary(res1)
```





Linear regression with interaction for April 2020 
```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_crua_10k ~ NOX_RED_abril2020 + `Densidad hab./km2` + NOX_RED_abril2020* `Densidad hab./km2` , data=model_risk)
summary(res1)
```





Linear regression with no interaction for May 2020 
```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_crua_10k ~ NOX_RED_mayo2020 + `Densidad hab./km2`  , data=model_risk)
summary(res1)
```


Linear regression with interaction for May 2020 
```{r}
#datos demograficos
# taxa_estandard_10k

res1<-lm(taxa_crua_10k ~ NOX_RED_mayo2020 + `Densidad hab./km2` + NOX_RED_mayo2020* `Densidad hab./km2` , data=model_risk)
summary(res1)
```

Linear regression with interaction for density and income
```{r}
#datos demograficos
#taxa_estandard_10k

res1<-lm(taxa_crua_10k ~ NOX_RED_mayo2020 + `Densidad hab./km2` + RFDB_hab_m +
            NOX_RED_mayo2020*RFDB_hab_m 
            , data=model_risk)
summary(res1)
```
